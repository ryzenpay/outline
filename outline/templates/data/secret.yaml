{{- $secret := (lookup "v1" "Secret" .Release.Namespace "outline-secret") -}}
apiVersion: v1
kind: Secret
metadata:
  name: outline-secret
  namespace: {{ .Release.Namespace }}
data:
  {{ if not $secret -}}
  SECRET_KEY: {{ randAlphaNum 100 | sha256sum | b64enc }}
  UTILS_SECRET: {{ randAlphaNum 100 | sha256sum | b64enc }}
  {{ if .Values.storage.s3.enabled }}
  S3_SECRET_KEY: {{ randAlphaNum 16 | b64enc | quote }}
  {{ end }}
  {{ end }}
  {{ if not .Values.oidc.secret.existing }}
  {{ .Values.oidc.secret.clientSecretKeyRef }}: {{ .Values.oidc.secret.clientSecret }}
  {{ end }}